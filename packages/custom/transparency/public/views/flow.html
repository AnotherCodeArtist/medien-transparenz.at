<section class="container">
    <div data-ng-controller="FlowCtrl">
        <div ng-intro-options="IntroOptions" ng-intro-method="FlowIntro" ng-intro-autostart="false">
            <div class="loadingDialog" data-ng-show="loading">
                <div class="text-center"><span translate>Loading Data to Update Diagram ...</span><br/>
                    <progressbar value="progress" max="100" type="info" class="progress-striped active"/>
                </div>
            </div>
            <div class="pull-right">
                <button type="button" class="btn btn-default" aria-label="?" data-ng-click="FlowIntro()">
                    <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                </button>
            </div>
            <h1 translate>Money Flow</h1>
            <!--p>Org-Groups: {{allOrganisationGroups}}</p-->

            <div class="panel panel-default" id="flowSettings">
                <div class="panel-heading">
                    <span translate>Settings</span>
                    <a href="#" class="pull-right btn" title="hide/show"
                       ng-click="showSettings = !showSettings"><i
                            class="glyphicon {{showSettings ? 'glyphicon-chevron-up':'glyphicon-chevron-down'}}"></i></a>
                </div>
                <div style="display: none">
                    <p translate="translate">Payments according to ยง2 MedKF-TG (Media Cooperations)</p>
                    <p translate="translate">Payments according to ยง4 MedKF-TG (Funding)</p>
                    <p translate="translate">Payments according to ยง31 ORF-G (Charges)</p>
                </div>
                <div class="panel-body" uib-collapse="!showSettings">
                    <div class="row">
                        <div class="col-sm-12 col-md-6 col-lg-6">
                            <div id="flowSlider">
                                <strong>
                                    <div><span translate>Periods</span>
                                        <a href ng-click="FlowIntro(1);"><i class="fa fa-info-circle"
                                                                            aria-hidden="true"></i></a>
                                    </div>
                                </strong>
                                <rzslider rz-slider-model="slider.from" rz-slider-high="slider.to"
                                          rz-slider-options="slider.options" ng-hide="fixedRange"></rzslider>
                            </div>
                            <div id="fixSliderRange">
                                <div class="checkbox">
                                    <label><input id="fixRange" type="checkbox"
                                                  ng-model="slider.options.draggableRangeOnly"/><span
                                            translate>Fix slider range</span></label>
                                    <a href ng-click="FlowIntro(2)"><i class="fa fa-info-circle" aria-hidden="true"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-6">
                            <div id="paymentTypes">
                                <strong>
                                    <div><span translate>Payment Types</span>
                                        <a href ng-click="FlowIntro(3);"><i class="fa fa-info-circle"
                                                                            aria-hidden="true"></i></a>
                                    </div>
                                </strong>
                            </div>
                            <div class="checkbox" data-ng-repeat="pType in typesText">
                                <label>
                                    <input type="checkbox" name="pType"
                                           ng-model="pType.checked"/>{{pType.text}}
                                </label>
                            </div>

                        </div>
                        <!--div class="col-sm3 col-lg-3">
                            <strong><div translate>Federal State</div></strong>
                           <select ng-model="selectedFederalState" ng-options="state.name for state in federalStates track by state.iso" name="federalStateSelect" id="federalStateSelect" >
                               <option value="">-</option>
                           </select>
                        </div-->
                    </div>

                </div>
            </div>
            <!--<div ng-show="org">
                <h3><a href="#" class="label label-success" ng-click="clearDetails()">{{org.name}} <span class="glyphicon glyphicon-remove-circle"></span></a></h3>
            </div>
            <!--div class="text-center query bg-primary">
                <div class="btn-group">
                    <input id="searchinput" placeholder="Filter"
                           ng-model="filter" type="search" class="searchinput form-control">
                    <span id="searchclear" ng-click="filter=''" class="searchclear glyphicon glyphicon-remove-circle"></span>
                </div>
            </div-->
            <br/>
            <div class="panel panel-default" id="selectionSettings">
                <div class="panel-heading">
                    <span translate>Selections</span>
                    <a href="#" class="pull-right btn" title="hide/show"
                       ng-click="selectionSettings = !selectionSettings"><i
                            class="glyphicon {{selectionSettings ? 'glyphicon-chevron-up':'glyphicon-chevron-down'}}"></i></a>
                </div>
                <div class="panel-body" uib-collapse="!selectionSettings">
                    <div class="row">
                        <div class="col-sm-12 col-lg-12">
                            <div ng-show="org.name && filter.length>=3" class="alert alert-warning" role="alert">
                                <span class="glyphicon glyphicon-exclamation-sign"></span>
                                <span translate>Your are currently viewing the details of {{org.name}} together with a text filter. This limits the results! Please consider clearing the filter to see all money transfers of this organisation.</span>
                            </div>

                            <div ng-show="error" class="alert alert-warning" role="alert">
                                <span class="glyphicon glyphicon-exclamation-sign"></span>
                                <span translate>Please select at least one organisation or media.</span>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="sankeyRow">
                        <div class="col-md-6 col-xs-12">
                            <span>{{organisationsLabel}}:</span><a href ng-click="FlowIntro(4);"><i
                                class="fa fa-info-circle"
                                aria-hidden="true"></i></a>
                            <oi-select class="multiselectDropdown"
                                       oi-options="item.name for item in loadOrganisations($query)"
                                       ng-model="selectedOrganisations"
                                       multiple
                                       placeholder="{{'Type a Name'|translate}}"
                                       id="multiselectOrg"
                                       oi-select-options="{
                                        searchFilter: 'groupFilter'
                                    }"
                            >

                            </oi-select>
                        </div>
                        <div class="col-md-6 col-xs-12">
                            <span>{{mediaLabel}}:</span><a href ng-click="FlowIntro(5);"><i class="fa fa-info-circle"
                                                                                            aria-hidden="true"></i></a>
                            <oi-select class="multiselectDropdown"
                                       oi-options="item.name for item in loadMedia($query)"
                                       ng-model="selectedMedia"
                                       multiple
                                       placeholder="{{'Type a Name'|translate}}"
                                       id="multiselectMedia"
                                       oi-select-options="{
                                        searchFilter: 'groupFilter'
                                    }"
                            ></oi-select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-xs-12">
                            <span>{{organisationGroupLabel}}:</span>
                            <a href ng-click="FlowIntro(6);"><i class="fa fa-info-circle" aria-hidden="true"></i></a>
                            <oi-select class="multiselectDropdown"
                                       oi-options="item.name for item in allOrganisationGroups track by item.name"
                                       ng-model="selectedOrganisationGroups"
                                       multiple
                                       placeholder="{{'Select a Group'|translate}}"
                                       id="multiselectOrgGroup"
                                       oi-select-options="{
                                        dropdownFilter: 'dropdownFilter',
                                        searchFilter: 'searchFilter'
                                    }"
                            >

                            </oi-select>
                        </div>
                        <div class="col-md-6 col-xs-12">
                            <span>{{mediaGroupLabel}}:</span>
                            <a href ng-click="FlowIntro(7);"><i class="fa fa-info-circle" aria-hidden="true"></i></a>
                            <oi-select class="multiselectDropdown"
                                       oi-options="item.name for item in allMediaGroups track by item.name"
                                       ng-model="selectedMediaGroups"
                                       multiple
                                       placeholder="{{'Select a Group'|translate}}"
                                       id="multiselectMediaGroup"
                                       oi-select-options="{
                                        dropdownFilter: 'dropdownFilter',
                                        searchFilter: 'searchFilter'
                                    }"
                            ></oi-select>
                        </div>
                    </div>
                    <div class="row" id="customGroups">
                        <div class="col-md-6">
                            <form name="localOrgGroupForm">
                                <span translate>Group all non-grouped organisations:</span>
                                <a href ng-click="FlowIntro(8);"><i class="fa fa-info-circle"
                                                                    aria-hidden="true"></i></a>
                                <div class="row">
                                    <div class="col-md-12">
                                        <input class="form-control" type="text" ng-model="localOrgGroupName"
                                               placeholder="{{'Organisation group name'|translate}}" required/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="btn-group" role="group">
                                            <button type="button" ng-disabled="localOrgGroupForm.$invalid"
                                                    class="btn btn-primary" ng-click="createLocalOrgGroup()">
                                                <i class="fa fa-object-group" aria-hidden="true"></i></i>&nbsp;<span
                                                    translate>Create new local group</span>
                                            </button>
                                            <button type="button"
                                                    class="btn btn-default" ng-click="editLocalGroups()">
                                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>&nbsp;<span
                                                    translate>Edit</span></button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div class="col-md-6">
                            <form name="localMediaGroupForm">
                                <span translate>Group all non-grouped media:</span>
                                <a href ng-click="FlowIntro(8);"><i class="fa fa-info-circle"
                                                                    aria-hidden="true"></i></a>
                                <div class="row">
                                    <div class="col-md-12">
                                        <input class="form-control" type="text" ng-model="localMediaGroupName"
                                               placeholder="{{'Media group name'|translate}}" required/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="btn-group" role="group">
                                            <button type="submit" ng-disabled="localMediaGroupForm.$invalid"
                                                    class="btn btn-primary" ng-click="createLocalMediaGroup()">
                                                <i class="fa fa-object-group" aria-hidden="true"></i>&nbsp;<span
                                                    translate>Create new local group</span>
                                            </button>
                                            <button type="button"
                                                    class="btn btn-default" ng-click="editLocalGroups()">
                                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>&nbsp;<span
                                                    translate>Edit</span></button>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        </form>
                    </div>
                </div>
                <div class="row" ng-show="localGroupError && localGroupError !== ''">
                    <div class="alert alert-danger col-md-12" role="alert">
                        <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                        {{localGroupError}}
                    </div>
                </div>
            </div>
        </div>
        <uib-tabset active="active">
            <uib-tab index="0" heading="{{'Money Flow' | translate}}">
                <div class="row">
                    <div class="sankeyChart col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div data-tpa-sankey data="flows" id="mychart" width="500px"
                             prog="progress" node-click="showDetails" link-click="showFlowDetails">
                        </div>
                    </div>
                </div>
            </uib-tab>
            <uib-tab index="1" heading="{{'Timeline' | translate}}">
                <div class="row">
                    <div class="alert alert-info col-md-12" role="alert">
                        <span class="glyphicon glyphicon-info-sign"></span>
                        <span translate>The first chart on that page shows the flow of money over the available period of time. The highest and the lowest value is highlighted. In case of events during a quarter, the events are emphasized.</span>
                    </div>
                </div>

                <div class="row">
                    <div class="timeline col-md-12">
                        <div tpa-timeline data="data" id="graph" class="aGraph" get-current-language="getCurrentLanguage()"
                             events="events"></div>
                        <svg id="timeline"></svg>
                    </div>
                </div>
                <div class="row">
                    <div class="alert alert-info col-md-12" role="alert">
                        <span class="glyphicon glyphicon-info-sign"></span>
                        <span translate>The second chart shows differences between the money flow compared to the previous quarter. The highest and lowest value is highlighted. If available, events are shown.</span>
                    </div>
                </div>
                <div class="row">

                    <div class="quartercomparison col-md-12">
                        <div tpa-quartercomparison data="annualComparisonData" get-current-language="getCurrentLanguage()"
                             events="events"></div>
                        <svg id="quarterComparison"></svg>
                    </div>
                </div>
            </uib-tab>
        </uib-tabset>

        <div class="row" data-ng-show="flowData.length>0">
            <h4 translate>Tabular Representation</h4>
            <div class="table-responsive">
                <table datatable="" dt-options="dtOptions" dt-columns="dtColumns" dt-instance="dtInstance"
                       class="table table-striped"></table>
            </div>
            <br/><br/><br/><br/>
        </div>
    </div>
    </div>
    <br/>
</section>